<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel="icon" href="../assets/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="../styles/styles.css"/>

  <!-- Patch UI v2 -->
  <link rel="stylesheet" href="../css/asd-tabs-override-v2.css?v=2"/>

  <title>Calendario — ASD</title>

  <style>
    /* Toolbar */
    .cal-toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:0 0 12px 0 }
    .cal-toolbar .spacer { flex:1 1 auto; }

    /* Pannello ANNO */
    .year-panel {
      display:none;
      gap:8px;
      align-items:center;
      margin:8px 0 14px 0;
      padding:10px;
      border-radius:12px;
      background: rgba(0,0,0,.25);
    }
    .year-panel.is-open { display:flex; }

    .months-grid {
      display:grid;
      grid-template-columns: repeat(6, minmax(90px, 1fr));
      gap:8px;
      width:100%;
    }
    .month-btn {
      padding:10px 8px;
      border-radius:10px;
      border:0;
      font-weight:600;
      cursor:pointer;
    }
    .month-btn:hover { filter: brightness(1.06); }

    .nav-btn {
      padding:8px 10px;
      border-radius:10px;
      border:0;
      font-weight:600;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="page">
    <a class="back" href="../index.html">← Torna alla home</a>

    <div class="brand">
      <img class="brand-logo" src="../assets/logo.png" alt="Logo ASD Santi Pietro e Paolo" />
      <div class="brand-title">
        <h1>Calendario attività</h1>
        <div class="brand-sub">ASD Santi Pietro e Paolo</div>
      </div>
    </div>

    <div class="card">
      <p>Calendario allenamenti e partite</p>

      <!-- TOOLBAR -->
      <div class="cal-toolbar">
        <button class="btn" id="btn-day"   type="button">Giorno (Agenda)</button>
        <button class="btn" id="btn-week"  type="button">Settimana</button>
        <button class="btn" id="btn-month" type="button">Mese</button>
        <button class="btn" id="btn-year"  type="button">Anno</button>

        <!-- Scorrimento mesi attivo in vista Mese -->
        <span class="spacer"></span>
        <button class="nav-btn" id="btn-prev" title="Mese precedente">←</button>
        <button class="nav-btn" id="btn-next" title="Mese successivo">→</button>

        <a id="openCalendarFull" class="btn" href="#">Schermo intero</a>
      </div>

      <!-- PANNELLO ANNO (griglia 12 mesi + selettore anno) -->
      <div id="yearPanel" class="year-panel" aria-hidden="true">
        <label for="yearSelect" style="font-weight:700;">Anno:</label>
        <select id="yearSelect"></select>
        <div class="months-grid" id="monthsGrid"></div>
      </div>

      <!-- IFRAME responsivo -->
      <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px">
        <iframe 
          id="calendar-embed"
          src=""
          style="border:0;position:absolute;top:0;left:0;width:100%;height:100%;border-radius:12px;" 
          frameborder="0" scrolling="no">
        </iframe>
      </div>
    </div>
  </div>

  <!-- Modale full-screen -->
  <div id="asd-modal" class="asd-modal" aria-hidden="true">
    <div class="asd-modal__inner">
      <button type="button" class="asd-modal__close" aria-label="Chiudi">✕</button>
      <div class="asd-modal__body"></div>
    </div>
  </div>

  <!-- JS patch v2 -->
  <script src="../js/asd-modal-v2.js?v=2" defer></script>

  <!-- JS locale -->

  <script>
document.addEventListener('DOMContentLoaded', function () {
  // URL embed "safe"
  const BASE = "https://calendar.google.com/calendar/embed";
  const CAL  = "29d83543be0fbbe269fcc9cb7018d6356%40group.calendar.google.com";
  const COMMON = "ctz=Europe%2FRome&showTitle=0&showPrint=0&showTabs=1&showDate=1&showNav=1&showCalendars=0&hl=it";

  const iframe   = document.getElementById('calendar-embed');
  const openBtn  = document.getElementById('openCalendarFull');
  const yearPanel= document.getElementById('yearPanel');
  const yearSelect = document.getElementById('yearSelect');
  const monthsGrid = document.getElementById('monthsGrid');

  // Stato
  const today = new Date();
  const state = { mode: 'WEEK', year: today.getFullYear(), month: today.getMonth() };

  // Helpers
  const pad = n => n.toString().padStart(2, '0');
  function lastDayOfMonth(y, mZeroBased) {
    return new Date(y, mZeroBased + 1, 0).getDate();
  }
  function monthRange(y, mZeroBased) {
    const start = `${y}${pad(mZeroBased+1)}01`;
    const end   = `${y}${pad(mZeroBased+1)}${pad(lastDayOfMonth(y, mZeroBased))}`;
    return `${start}/${end}`;
  }
  const urlForMode = (mode) => `${BASE}?src=${CAL}&${COMMON}&mode=${mode}`;
  const urlForMonth = (y, mZeroBased) =>
    `${BASE}?src=${CAL}&${COMMON}&mode=MONTH&dates=${monthRange(y, mZeroBased)}`;

  // Applica URL e gestisci visibilità frecce
  function setIframe(src) {
    iframe.src = src;
    document.getElementById('btn-prev').style.display =
    document.getElementById('btn-next').style.display = src.includes('mode=MONTH') ? 'inline-block' : 'none';
  }

  // Iniziale
  setIframe(urlForMode(state.mode));

  // Bottoni vista
  document.getElementById('btn-day').addEventListener('click',  () => { state.mode='AGENDA'; yearPanel.classList.remove('is-open'); setIframe(urlForMode('AGENDA')); });
  document.getElementById('btn-week').addEventListener('click', () => { state.mode='WEEK';   yearPanel.classList.remove('is-open'); setIframe(urlForMode('WEEK'));   });
  document.getElementById('btn-month').addEventListener('click',() => { state.mode='MONTH';  yearPanel.classList.remove('is-open'); setIframe(urlForMode('MONTH'));  });

  // Pannello ANNO (apri/chiudi)
  document.getElementById('btn-year').addEventListener('click', () => {
    yearPanel.classList.toggle('is-open');
    // sincronizza selettore anno
    if (!yearSelect.options.length) {
      const base = today.getFullYear();
      for (let y = base - 3; y <= base + 3; y++) {
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y; if (y === state.year) opt.selected = true;
        yearSelect.appendChild(opt);
      }
      const mesi = ['Gen','Feb','Mar','Apr','Mag','Giu','Lug','Ago','Set','Ott','Nov','Dic'];
      mesi.forEach((name, idx) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'month-btn';
        b.textContent = name;
        b.addEventListener('click', () => {
          state.year = parseInt(yearSelect.value,10);
          state.month = idx;
          state.mode = 'MONTH';
          // URL con dates=YYYYMM01/YYYYMMDD (funziona in embed)
          setIframe(urlForMonth(state.year, state.month));
        });
        monthsGrid.appendChild(b);
      });
    }
  });

  // Scorrimento mesi (funziona perché restiamo in MONTH; se non lo siamo, portiamo a MONTH corrente)
  document.getElementById('btn-prev').addEventListener('click', () => {
    if (state.mode !== 'MONTH') { state.mode='MONTH'; setIframe(urlForMode('MONTH')); return; }
    const d = new Date(state.year, state.month - 1, 1);
    state.year = d.getFullYear(); state.month = d.getMonth();
    setIframe(urlForMonth(state.year, state.month));
  });
  document.getElementById('btn-next').addEventListener('click', () => {
    if (state.mode !== 'MONTH') { state.mode='MONTH'; setIframe(urlForMode('MONTH')); return; }
    const d = new Date(state.year, state.month + 1, 1);
    state.year = d.getFullYear(); state.month = d.getMonth();
    setIframe(urlForMonth(state.year, state.month));
  });

  // Schermo intero: stessa vista corrente
  openBtn.addEventListener('click', function (e) {
    e.preventDefault();
    const modal = document.getElementById('asd-modal');
    const body  = modal.querySelector('.asd-modal__body');

    let src;
    if (state.mode === 'MONTH') src = urlForMonth(state.year, state.month);
    else src = urlForMode(state.mode);

    body.innerHTML = `<iframe src="${src}" width="100%" height="100%" frameborder="0"></iframe>`;
    modal.classList.add('is-open');
    document.documentElement.style.overflow = 'hidden';
  });
});
</script>



</body>
</html>


